q <- 1 - p
f_LL <- p^2
f_LD <- 2 * p * q
f_DD <- q^2
# Mean fitness of population
w_bar <- f_LL * w_LL + f_LD * w_LD + f_DD * w_DD
# New allele frequency after selection
p_next <- (f_LL * w_LL + 0.5 * f_LD * w_LD) / w_bar
p_vec[gen] <- p_next
# Stop early if allele frequency reaches 0.9
if (p_next >= 0.9) {
cat("Reached p = 0.9 at generation", gen, "\n")
p_vec <- p_vec[1:gen]
break
}
}
# Plot allele frequency over generations
plot(p_vec, type = "l", lwd = 2, col = "blue",
xlab = "Generation", ylab = "Frequency of light allele (p)",
main = "Allele Frequency Over Time under Selection")
abline(h = 0.9, col = "red", lty = 2)
?abline
abline(v = 131, col = 'green', lty=1)
# Plot allele frequency over generations
plot(p_vec, type = "l", lwd = 2, col = "blue",
xlab = "Generation", ylab = "Frequency of light allele (p)",
main = "Allele Frequency Over Time under Selection",
xlim = c(0, 140))
abline(h = 0.9, col = "red", lty = 2)
abline(v = 131, col = 'green', lty=1)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source('useful_functions.R')
sample_size = seq(from=10, to=800, by=10)
mean_list = c()
sd_list = c()
growth_proportion = c()
bottleneck_proportion = c()
ancestral_proportion = c()
dadi_nu_shape = c()
dadi_time = c()
msprime_time = c()
msprime_nu_shape = c()
# Iterate through sample size and replicate
for (i in sample_size) {
this_sample_size_distribution = c() # Initialize
dadi_demography = paste0(
"../Analysis/dadi_3EpB_", i, '/two_epoch_demography.txt')
dadi_nu = nu_from_demography(dadi_demography)
dadi_time = c(dadi_time, time_from_demography(dadi_demography))
msprime_demography = paste0(
"../Analysis/msprime_3EpB_", i, '/two_epoch_demography.txt')
msprime_nu = nu_from_demography(msprime_demography)
msprime_time = c(msprime_time, time_from_demography(msprime_demography))
if (is.na(dadi_nu)) {
dadi_nu_shape = c(dadi_nu_shape, NA)
} else if (dadi_nu > 1) {
dadi_nu_shape = c(dadi_nu_shape, 'dadi_expand')
} else {
dadi_nu_shape = c(dadi_nu_shape, 'dadi_contract')
}
if (is.na(msprime_nu)) {
msprime_nu_shape = c(msprime_nu_shape, NA)
} else if (msprime_nu > 1) {
msprime_nu_shape = c(msprime_nu_shape, 'msprime_expand')
} else {
msprime_nu_shape = c(msprime_nu_shape, 'msprime_contract')
}
for (j in seq(from=1, to=20, by=1)) {
this_replicate_distribution = paste0(
"../Simulations/simple_simulations/ThreeEpochBottleneck_",
i, '_coal_dist_',
j, '.csv')
# Read in the appropriate file
this_csv = read.csv(this_replicate_distribution, header=TRUE)
this_sample_size_distribution = c(this_sample_size_distribution, this_csv$generations)
}
# Take the mean of coalescent times for this sample size's distribution
mean_list = c(mean_list, mean(this_sample_size_distribution))
# Similarly, take standard deviation
sd_list = c(sd_list, sd(this_sample_size_distribution))
# Lastly find the proportion of coalescent events in each epoch
growth_proportion = c(growth_proportion,
mean(this_sample_size_distribution < 200))
bottleneck_proportion = c(bottleneck_proportion,
mean(this_sample_size_distribution <= 2000) - mean(this_sample_size_distribution < 200))
ancestral_proportion = c(ancestral_proportion,
mean(this_sample_size_distribution > 2000))
}
figure_3A_dataframe = data.frame(
mean_list,
sd_list,
sample_size
)
plot_3A = ggplot(data=figure_3A_dataframe, aes(x=sample_size, y=mean_list)) +
geom_line(size=2) +
geom_errorbar(aes(ymin = mean_list - sd_list, ymax = mean_list + sd_list), width = 10) +
theme_bw() +
xlab('Sample size') +
ylab("Mean coalescent time (generations)") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed')
plot_3A = ggplot(data=figure_3A_dataframe, aes(x=sample_size, y=mean_list)) +
geom_line(linewidth=2) +
geom_errorbar(aes(ymin = mean_list - sd_list, ymax = mean_list + sd_list), width = 10) +
theme_bw() +
xlab('Sample size') +
ylab("Mean coalescent time (generations)") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed')
figure_3B_dataframe = melt(data.frame(
growth_proportion,
bottleneck_proportion,
ancestral_proportion
))
figure_3B_dataframe$nu_time = dadi_time
figure_3B_dataframe$nu_shape = dadi_nu_shape
figure_3B_dataframe$msprime_time = msprime_time
figure_3B_dataframe$msprime_shape = msprime_shape
figure_3B_dataframe$sample_size = sample_size
plot_3B = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#fbb4ae',
'bottleneck_proportion'='#b3cde3',
'ancestral_proportion'='#ccebc5'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population'))
plot_3A + plot_3B + plot_layout(nrow=2)
plot_3B = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#fbb4ae',
'bottleneck_proportion'='#b3cde3',
'ancestral_proportion'='#ccebc5'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population'))
plot_3A + plot_3B + plot_layout(nrow=2)
figure_3B_dataframe = melt(data.frame(
growth_proportion,
bottleneck_proportion,
ancestral_proportion
))
figure_3B_dataframe$nu_time = dadi_time
figure_3B_dataframe$nu_shape = dadi_nu_shape
figure_3B_dataframe$msprime_time = msprime_time
figure_3B_dataframe$msprime_shape = msprime_nushape
figure_3B_dataframe$sample_size = sample_size
plot_3B = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=dadi_nu_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#fbb4ae',
'bottleneck_proportion'='#b3cde3',
'ancestral_proportion'='#ccebc5'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population'))
plot_3A + plot_3B + plot_layout(nrow=2)
figure_3B_dataframe
figure_3B_dataframe = melt(data.frame(
growth_proportion,
bottleneck_proportion,
ancestral_proportion
))
figure_3B_dataframe$nu_time = dadi_time
figure_3B_dataframe$dadi_shape = dadi_nu_shape
figure_3B_dataframe$msprime_time = msprime_time
figure_3B_dataframe$msprime_shape = msprime_nushape
figure_3B_dataframe$sample_size = sample_size
plot_3B = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=dadi_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#fbb4ae',
'bottleneck_proportion'='#b3cde3',
'ancestral_proportion'='#ccebc5'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population'))
plot_3A + plot_3B + plot_layout(nrow=2)
plot_3B = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=dadi_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#1b9e77',
'bottleneck_proportion'='#d95f02',
'ancestral_proportion'='#7570b3'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population'))
plot_3A + plot_3B + plot_layout(nrow=2)
plot_3B = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=dadi_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#1b9e77',
'bottleneck_proportion'='#d95f02',
'ancestral_proportion'='#7570b3'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population')) +
scale_shape_manual(name='Dadi, inferred demographic event',
breaks=c('dadi_contract',
'dadi_expand'),
values=c('dadi_contract'=15,
'dadi_expand'=22),
labels=c('Dadi, contraction',
'Dadi, expansion'))
plot_3A + plot_3B + plot_layout(nrow=2)
plot_3C = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=msprime_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#1b9e77',
'bottleneck_proportion'='#d95f02',
'ancestral_proportion'='#7570b3'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population')) +
scale_shape_manual(name='MSPrime, inferred demographic event',
breaks=c('msprime_contract',
'msprime_expand'),
values=c('msprime_contract'=15,
'msprime_expand'=22),
labels=c('MSPrime, contraction',
'MSPrime, expansion')) +
guides(color='none')
plot_3A + plot_3B + plot_3C + plot_layout(nrow=3)
figure_3B_dataframe = melt(data.frame(
growth_proportion,
bottleneck_proportion,
ancestral_proportion
))
figure_3B_dataframe$nu_time = dadi_time
figure_3B_dataframe$dadi_shape = dadi_nu_shape
figure_3B_dataframe$msprime_time = msprime_time
figure_3B_dataframe$msprime_shape = msprime_nu_shape
figure_3B_dataframe$sample_size = sample_size
plot_3B = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=dadi_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#1b9e77',
'bottleneck_proportion'='#d95f02',
'ancestral_proportion'='#7570b3'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population')) +
scale_shape_manual(name='Dadi, inferred demographic event',
breaks=c('dadi_contract',
'dadi_expand'),
values=c('dadi_contract'=15,
'dadi_expand'=22),
labels=c('Dadi, contraction',
'Dadi, expansion'))
plot_3C = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=msprime_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#1b9e77',
'bottleneck_proportion'='#d95f02',
'ancestral_proportion'='#7570b3'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population')) +
scale_shape_manual(name='MSPrime, inferred demographic event',
breaks=c('msprime_contract',
'msprime_expand'),
values=c('msprime_contract'=15,
'msprime_expand'=22),
labels=c('MSPrime, contraction',
'MSPrime, expansion')) +
guides(color='none')
plot_3A + plot_3B + plot_3C + plot_layout(nrow=3)
plot_3C = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=msprime_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
# ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#1b9e77',
'bottleneck_proportion'='#d95f02',
'ancestral_proportion'='#7570b3'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population')) +
scale_shape_manual(name='MSPrime, inferred demographic event',
breaks=c('msprime_contract',
'msprime_expand'),
values=c('msprime_contract'=15,
'msprime_expand'=22),
labels=c('MSPrime, contraction',
'MSPrime, expansion')) +
guides(color='none')
plot_3A + plot_3B + plot_3C + plot_layout(nrow=3)
figure_3D_dataframe = melt(data.frame(
mean_list,
dadi_time,
msprime_time
))
figure_3D_dataframe$sample_size=sample_size
plot_4D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('mean_list',
'dadi_time',
'msprime_time'),
values=c(mean_list='#66c2a5',
dadi_time='#fc8d62',
msprime_time='#8da0cb'),
labels=c('Mean coalescent time',
'Inferred dadi time',
'Inferred msprime time')
)
plot_3D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('mean_list',
'dadi_time',
'msprime_time'),
values=c(mean_list='#66c2a5',
dadi_time='#fc8d62',
msprime_time='#8da0cb'),
labels=c('Mean coalescent time',
'Inferred dadi time',
'Inferred msprime time')
)
plot_3A + plot_3B + plot_3C + plot_4D + plot_layout(nrow=3)
plot_3A + plot_3B + plot_3C + plot_4D + plot_layout(nrow=4)
plot_3C = ggplot(data=figure_3B_dataframe, aes(x=sample_size, y=value, color=variable, shape=msprime_shape)) +
geom_point(size=2) +
theme_bw() +
xlab('Sample size') +
ylab('Proportion') +
# ggtitle('Proportion of coalescent events per epoch') +
scale_color_manual(name='Epoch',
breaks=c('growth_proportion',
'bottleneck_proportion',
'ancestral_proportion'),
values=c('growth_proportion'='#1b9e77',
'bottleneck_proportion'='#d95f02',
'ancestral_proportion'='#7570b3'),
labels=c('Recent growth', 'Bottleneck', 'Ancestral population')) +
scale_shape_manual(name='MSPrime, inferred demographic event',
breaks=c('msprime_contract',
'msprime_expand'),
values=c('msprime_contract'=15,
'msprime_expand'=22),
labels=c('MSPrime, contraction',
'MSPrime, expansion')) +
guides(color='none')
plot_3A + plot_3B + plot_3C + plot_layout(nrow=3)
plot_3D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('mean_list',
'dadi_time',
'msprime_time'),
values=c(mean_list='#66c2a5',
dadi_time='#fc8d62',
msprime_time='#8da0cb'),
labels=c('Mean coalescent time',
'Inferred dadi time',
'Inferred msprime time')
)
plot_3A + plot_3B + plot_3C + plot_3D + plot_layout(nrow=4)
plot_3D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('dadi_time',
'msprime_time'),
values=c(mean_list=dadi_time="#0C7BDC",
plot_3D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('dadi_time',
'msprime_time'),
values=c(dadi_time='#0C7BDC',
msprime_time='#FFC20A'),
labels=c('Mean coalescent time',
'Inferred dadi time',
'Inferred msprime time')
)
plot_3A + plot_3B + plot_3C + plot_3D + plot_layout(nrow=4)
plot_3D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('dadi_time',
'msprime_time'),
values=c(dadi_time='#0C7BDC',
msprime_time='#FFC20A'),
labels=c('Inferred dadi time',
'Inferred msprime time')
)
plot_3A + plot_3B + plot_3C + plot_3D + plot_layout(nrow=4)
figure_3D_dataframe = melt(data.frame(
dadi_time,
msprime_time
))
figure_3D_dataframe$sample_size=sample_size
plot_3D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Mean coalescent time by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('dadi_time',
'msprime_time'),
values=c(dadi_time='#0C7BDC',
msprime_time='#FFC20A'),
labels=c('Inferred dadi time',
'Inferred msprime time')
)
plot_3A + plot_3B + plot_3C + plot_3D + plot_layout(nrow=4)
plot_3D = ggplot(data=figure_3D_dataframe, aes(x=sample_size, y=value, color=variable)) +
geom_line(size=2) +
theme_bw() +
xlab('Sample size') +
ylab("Time in generations") +
ggtitle("Inferred time of instantaneous size change by sample size") +
geom_hline(yintercept = 1, size = 1, linetype = 'dashed') +
scale_y_log10() +
scale_color_manual(name='Type of time',
breaks=c('dadi_time',
'msprime_time'),
values=c(dadi_time='#0C7BDC',
msprime_time='#FFC20A'),
labels=c('Inferred dadi time',
'Inferred msprime time')
)
plot_3A + plot_3B + plot_3C + plot_3D + plot_layout(nrow=4)
